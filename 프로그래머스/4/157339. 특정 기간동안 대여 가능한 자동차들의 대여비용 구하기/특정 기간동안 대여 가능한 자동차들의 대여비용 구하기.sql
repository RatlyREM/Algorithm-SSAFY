SELECT CAR_ID, A.CAR_TYPE, FLOOR(DAILY_FEE * ((100-DISCOUNT_RATE)/100))*30 FEE
FROM 
(SELECT *
FROM CAR_RENTAL_COMPANY_DISCOUNT_PLAN CP
WHERE DURATION_TYPE = '30일 이상' ) A
JOIN
(SELECT CC.CAR_ID, CAR_TYPE, DAILY_FEE
FROM CAR_RENTAL_COMPANY_CAR CC LEFT JOIN
(SELECT *
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
WHERE (START_DATE >= '2022-11-01 00:00:00' AND START_DATE <= '2022-11-30 23:59:59') OR
(END_DATE >= '2022-11-01 00:00:00' AND END_DATE <= '2022-11-30 23:59:59') OR
(START_DATE < '2022-11-01 00:00:00' AND END_DATE > '2022-11-30 23:59:59')
ORDER BY CAR_ID) CH
ON CC.CAR_ID = CH.CAR_ID
WHERE CH.CAR_ID IS NULL AND (CAR_TYPE='SUV' OR CAR_TYPE='세단')) B
ON A.CAR_TYPE= B.CAR_TYPE
WHERE FLOOR(DAILY_FEE * ((100-DISCOUNT_RATE)/100))*30 BETWEEN 500000 AND 2000000
ORDER BY FEE DESC, CAR_TYPE, CAR_ID DESC